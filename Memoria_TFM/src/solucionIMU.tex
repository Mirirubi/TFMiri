\chapter{Solución con sensores IMU\label{sec:IMU}}
%------------------------------
%------___SOLUCIÓN_IMU___------
%------------------------------

\textcolor{rositaoscuro}{asdf}
\textcolor{teal}{sdffsd}

\label{sec:IMU4}

Durante la realización del prototipo expuesto en el capítulo precedente se advierte la necesidad de modificar la tecnología utilizada para diseñar un prototipo que cubra con todas las necesidades del escenario. En este capítulo se propone una solución sensores inerciales. 

Esta propuesta se sustenta en la bibliografía encontrada en la que se emplea esta solución en este tipo de escenarios. La referencia que más ha inspirado esta solución ha sido el trabajo de Henk Kortier en su tesis. \cite{Kortier} 

Al final del capítulo se realiza la comparativa frente al prototipo de FBG, para comprender mejor la ventajas que aporta esta propuesta frente al prototipo desarrollado. 

%--Marco conceptual
\section{Marco conceptual}
\label{sec:marco4}

Este apartado tiene por finalidad realizar una clara exposición de los conceptos teóricos fundamentales para la comprensión del diseño llevado a cabo. Se exponen conceptos básicos de los sensores inerciales y el microcontrolador ESP32.  


%--asdf
\subsection{Sensores inerciales}
\label{sec:asdf4}

Los sensores inerciales se rigen por las leyes de movimiento de Newton. Son sensores capaces de medir la variación del movimiento respecto estas leyes. Estos sensores también se conocen como IMU \textit{(Inertial Magnetic Unit}).
Dentro de este tipo de sensores se encuentra el acelerómetro, el giroscopio y el magnetómetro.

\begin{figure}[H]
	\centering
	\includegraphics[width=0.8\textwidth]{./img/movimientoAcelera}
	\caption{Movimientos básicos asociados con la aceleración de un objeto. \cite{juanDiego}} 
	\label{fig:movimientosAcelera}
\end{figure} 


La combinación de estos tres sensores (junto con la referencia temporal) hace posible detectar cinco movimientos diferentes: aceleración, vibración, golpe (choque, shock), inclinación (tilt) y rotación (pan).

A continuación se explica brevemente cada uno de los tres tipos de sensores. \cite{juanDiego}

%\newpage %Salto de pagina
	\begin{itemize}
		%-Acelerómetro
		\item \textit{\textbf{Acelerómetro}}	
		% \hspace{0.2cm} 
		\begin{figure}[H]
			\centering
			\includegraphics[width=0.25\textwidth]{./img/IMUacelerometro}
			\caption{Lectura de aceleración lineal en los ejes del acelerómetro. \cite{juanDiego}} 
			\label{fig:IMUacelerometro}
		\end{figure} 
		
		El acelerómetro mide la aceleración de un objeto al que va unido gracias a la referencia respecto de una masa inercial interna. Más en concreto, mide la segunda derivada de la posición, la fuerza de inercia que se genera cuando a una masa le afecta un cambio de velocidad.
		
		A la hora de utilizar estos sensores hay que tener en cuenta el valor de la temperatura y frecuencia de funcionamiento, además de la desviación estándar que tenga el sensor específico.
		
		El modelo matemático de un acelerómetro es el siguiente:
		\begin{equation}
			\label{eq:modeloAcelera}
			a = G_{a}\; a_{0} + b_{a} + n_{a}
		\end{equation}
		dónde, $ G_{a} $ es el factor de escala que da el fabricante, $ a_{0} $ es el valor de aceleración medido por el sensor inercial,  $ b_{a} $ es el bias o error sistemático que lo da el fabricante y $ n_{a} $ que es ruido blanco gaussiano.
		
	
		%-Giroscopio
		\item \textit{\textbf{Giroscopio}}	
		% \hspace{0.2cm} 
		
		\begin{figure}[H]
			\centering
			\includegraphics[width=0.35\textwidth]{./img/IMUgiroscopo}
			\caption{Esquema típico de un giroscopio. \cite{juanDiego}} 
			\label{fig:IMUgiroscopo}
		\end{figure} 
		
		Este tipo de sensor sirve para medir la orientación. El principio de funcionamiento de un giroscopio reside en la conservación del momento angular. 
		
		En la fígura \ref{fig:IMUgiroscopo} se observan los cuatro elementos que compone un giroscopio típico. Tratándose  de un dispositivo con forma esférica que tiene en su centro un disco que puede rotar libremente en cualquier dirección sobre su eje de simetría. 
				
		Mientras que en el caso de los acelerómetros se mide la aceleración lineal, en los giróscopos se mide la aceleración angular.
		
		El modelo matemático de un giroscopio es el siguiente:
		\begin{equation}
			\label{eq:modelogiroscopo}
			\omega = G_{g}\; \omega_{0} + b_{g} + n_{g}
		\end{equation}
		dónde, $ G_{g} $ es el factor de escala que da el fabricante, $\omega_{0} $ es el valor de aceleración angular medido por el sensor inercial,  $ b_{g} $ es el bias o error sistemático que lo da el fabricante y $ n_{g} $ que es ruido blanco gaussiano.
		
		
		%-Magnetómetro
		\item \textit{\textbf{Magnetómetro}}	
		% \hspace{0.2cm} 
		\begin{figure}[H]
			\centering
			\includegraphics[width=0.55\textwidth]{./img/IMUmagnetometro}
			\caption{Esquema típico de un magnetómetro. \cite{juanDiego}} 
			\label{fig:IMUmagneto}
		\end{figure} 
		
		Mide la intensidad de un campo magnético en tres ejes. De ello se obtiene un vector de campo que da información del ángulo de azimut o de su altitud. Podría decirse que es la función d euna brujula en tres dimensiones, con la capacidad de distinguir giros en el eje de roll y pitch. Entender cómo funciona el campo magnético terrestre facilita la comprensión del funcionamiento de este tipo de sensores (\ref{fig:campoMag}).
		
		\begin{figure}[H]
			\centering
			\includegraphics[width=0.55\textwidth]{./img/IMUmagneto}
			\caption{Líneas de campo magnético terrestre referencia Norte-Sur. \cite{juanDiego}} 
			\label{fig:campoMag}
		\end{figure} 
		
		El modelo matemático de un magnetómetro (ecuación \ref{eq:modeloMagneto}) es similar al del acelerómetro y el giroscopio con la diferencia de lo que se mide es intensidad de campo magnético en vez de aceleración. 
		\begin{equation}
			\label{eq:modeloMagneto}
			m = G_{m}\; m_{0} + b_{m} + n_{m}
		\end{equation}
		dónde, $ G_{m} $ es el factor de escala que da el fabricante, $m_{0} $ es el valor de intensidad de campo magnético medido por el sensor inercial,  $ b_{m} $ es el bias o error sistemático que lo da el fabricante y $ n_{m} $ que es ruido blanco gaussiano.
		
		
	\end{itemize}
	


\subsection{Microcontrolador basado en ESP32}
\label{sec:esp324}

	\begin{figure}[H]
		\centering
		\includegraphics[width=0.4\textwidth]{./img/esp32}
		\caption{Módulo ESP32. } 
		\label{fig:esp32}
	\end{figure} 


\begin{table}[H]
	\centering
	\begin{tabular}{|l|c|}
		\hline
		{\cellcolor[HTML]{EFEFEF}Cores}                                      & 2                             	\\ \hline
		{\cellcolor[HTML]{EFEFEF}Arquitectura}                               & 32 bit                         	\\ \hline
		{\cellcolor[HTML]{EFEFEF}Frecuencia de reloj} 						 & 160 MHz 							\\ \hline
		{\cellcolor[HTML]{EFEFEF}Wifi}                                       & Sí                             \\ \hline
		{\cellcolor[HTML]{EFEFEF}Bluetooth}                                  & Sí                             \\ \hline
		{\cellcolor[HTML]{EFEFEF}RAM}                                        & 512 KB                         \\ \hline
		{\cellcolor[HTML]{EFEFEF}FLASH}                                      & 16 MB                          \\ \hline
		{\cellcolor[HTML]{EFEFEF}Pines GPIO}                                 & 36                             \\ \hline
		{\cellcolor[HTML]{EFEFEF}Buses}                                      & SPI, I2C, UART, I2S, CAN       \\ \hline
		{\cellcolor[HTML]{EFEFEF}Pines ADC}                                  & 18                             \\ \hline
		
	\end{tabular}
	\caption{Tabla de propiedades características ESP32}
	\label{tabla:ESP32}
\end{table}

Se ha elegido el módulo ESP32 (figura \ref{fig:esp32}) frente a otros módulos existentes por sus competentes prestaciones. En la tabla \ref{tabla:ESP32} se resumen sus características más notables. De entre ellas, las que más hacen destacar al ESP32 son la frecuencia de la CPU, el número de cores y la cantidad de capacidad de conectividad de la que dispone sin necesidad de agragarle dispositivos extra (ver figura \ref{fig:esp32tabla}).


	\begin{figure}[H]
		\centering
		\includegraphics[width=0.8\textwidth]{./img/esp32diagrama}
		\caption{Diagrama de bloques de ESP32. } 
		\label{fig:esp32tabla}
	\end{figure} 

Todo esto sin recurrir a un aumento del tamaño frente a otros ódulos de este tipo. El módulo ESP32 mide en torno a los $12\;cm^{2}$ ($ 51 \times 23 mm $) de área.


%--Desarrollo del prototipo
\section{Prototipo propuesto}
\label{sec:prototipo4}

En esta sección se presenta el concepto del prototipo basado en IMUs propuesto. Aunque no se ha podido realizar como prototipo por tiempo, se ha experimentado con este tipo de sensores.

\subsection{Disposición}
\label{sec:materiales4}

Los elementos fundamentales en esta propuesta son los sensores IMU y el módulo ES32. La base de este prototipo es que se pretende conocer el movimiento de cada una de las falanges de los dedos, el dorso y la muñeca. Para ello se propone colocar los elementos como se esboza en la figura \ref{fig:disposicionIMU}. Una ventaja de emplear esta distribución junto con esta tecnología es que no influye tanto al resultado medido la colocación exacta de los sensores. 

\begin{figure}[H]
	\centering
	\includegraphics[width=0.6\textwidth]{./img/IMU2}
	\caption{Disposición de los elementos del prototipo sobe la mano. } 
	\label{fig:disposicionIMU}
\end{figure} 

Lo importante en esta propuesta es que los sensores estén colocados en cada falange que le corresponda. Si este sensor se encuentra colocado a una distancia diferente de la articulación entre una sesión y otra no alterará el resultado de la medición.

Además, gracias al reducido tamaño del módulo ESP32, este se puede colocar sobre el dorso de la mano o en la muñeca. 

Se ha estudiado también que sensores se van a emplear. A la hora de elegir los sensores, la característica limitante ha sido el número de direcciones de los puertos I2C de estos.  


\subsection{Funcionamiento}
\label{sec:funcionamiento4}
asdf



\section{Resultados y análisis}
\label{sec:resultados4}

	Con esta propuesta soluciona la principal dificultad en el soporte físico del prototipo de FBG: la repercusión que tienen los cambios en la colocación del guante en la comparación entre diferentes sesiones de rehabilitación. 
	
	Además, conviene realizar una comparativa económica para entender la diferencia de precio entre ambas propuestas. En la siguiente tabla se presentan los precios aproximados de los componentes fundamentales de cada prototipo:
	
	
	

